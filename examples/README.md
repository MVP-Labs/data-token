

## MVP交互流程
考虑简单的两方纵向联邦学习，例如金融科技公司C为两家银行A、B提供客户画像和联合风控服务。假设银行的原始客户数据位于私域网络的数据库中，在保证数据安全且操作可审计的情况下，可以通过密码学方案(如秘密共享SS)将客户数据加密传递到银行间的联邦域网络，在密文基础上可进一步实现联合建模。在这里，银行同时作为数据源方和算力提供方，金融科技公司则是算法提供方和任务发起方，MVP流程如下：
1. 合约部署方为系统管理员，可以添加A、B、C的机构名和地址关系;
2. 银行A、B用DDO描述私域数据和联邦域算力的使用条款和服务类型，并生成CDT标识符；
3. 将以上生成的DDO存储在ipfs中，得到存储地址，将CDT、storage和proof注册到链上；
4. 公司C对数据/算力CDT进行组合，填充child_cdt_list以及对各资源的代码哈希，生成算法CDT后上ipfs并上链；
5. 银行A、B分别验证算法CDT是否满足资源使用条款，通过后将数据/算力CDT授权给算法CDT；
6. 算法提供方在链上任务市场新建一个任务，并将算法CDT提交到该任务的工作下；
7. 算法提供方远程操作各银行的数据/算力(附带签名、算法CDT和工作ID)。各银行需要核实该算法CDT是否取得授权、签名有效性和所有者、工作ID对应的状态等。通过的话，就允许访问发起远程计算。

Demo展示了上述流程的完整用例，关键代码模块包括：[demo.py](https://github.com/ownership-labs/cdt-sdk/blob/main/demo.py)、[provider.py](https://github.com/ownership-labs/cdt-sdk/blob/main/market/provider.py)、[dataset.py](https://github.com/ownership-labs/cdt-sdk/blob/main/market/dataset.py)。此外，CDT的潜在用例还很丰富，例如可以用于模型安全推断上。这通常是云提供商利用同态加密技术来加密模型、推断需求方加密数据，因此可以用一个包含两个操作的算法CDT来表示。


## MVP交互流程
DataToken SDK允许在分布式资源上进行可信可追溯的计算，并将提供三个场景MVP：1）企业间数据协作；2）用户级边缘计算；3）可追溯的隐私AI。

### 企业间数据协作

考虑简单的两方纵向联邦学习，例如金融科技公司C为两家银行A、B提供联合风控服务。假设银行的原始客户数据位于私域网络的数据库中(安全性等级高)，在保证数据安全且操作可审计的情况下，可以通过密码学方案(如秘密共享SS)将客户数据加密传递到银行间的联邦域网络(安全性等级稍低)，在密文基础上进一步实现MPC联合建模。在这里，银行A、B同时作为数据源方和算力提供方，金融科技公司C则是算法提供方和数据应用方。MVP流程如下：

1. 合约部署方为系统管理员，添加A、B、C的机构名和账户关系，同时将SS和MPC代码哈希注册到链上，脚本存储在IPFS中；
2. 银行A、B用DT/DDO描述私域数据和联邦域算力的服务条款，前者应支持SS操作，后者应支持MPC操作，生成四个dt标识符和四个ddo。将ddo存储在IPFS中，将dt、storage_path和proof注册到链上；
3. 公司C对数据/算力DT进行组合，填充child_dts以及对各资源的代码哈希，生成算法dt后存IPFS并上链；
4. 银行A、B分别验证算法dt是否满足资源使用条款，验证通过后，在链上将数据/算力dt授权给算法dt；
5. 公司C在链上任务市场新建一个任务，并将算法dt提交到该任务的工作下；
6. 公司C远程操作银行A、B的数据/算力。各银行需要核实该算法dt是否取得授权、所有者签名、任务工作状态等。通过的话，从IPFS下载代码脚本，并执行本地计算。

### 用户级边缘计算
考虑简单的移动端横向联邦学习，例如智慧医疗公司B希望在穿戴式设备提供商A的所有用户数据上进行心脏病预测模型训练。用户数据都在移动设备本地，用u_1,u_2,...,u_n表示。在这里，提供商A是数据源方，包含了诸多用户数据，公司B则是算法提供方和数据应用方。计算过程都在数据私域完成，没有显示的算力提供方，即设备商A运行梯度聚合(如FedAverage)，用户设备运行横向模型计算(EdgeComp)。MVP流程如下：

1. 合约部署方为系统管理员，添加A、B的机构名和账户关系，同时将EdgeComp和FedAverage代码哈希注册到链上，脚本存储在IPFS中；
2. 设备商A为其生态用户添加身份，设置一个链上用户注册表，用于控制资产发布；
3. n个用户和设备商B都注册数据资产。用户ddo中应支持EdgeComp操作，设备商DDO中应对n个用户dt进行组合，并定义工作流, workflows=[set_ops:[{0:ec},...,{n:ec},{n+1(self):fa}]]，即在用户设备上运行横向模型，在设备商的私域聚合梯度；
4. 医疗公司B注册算法资产，其中包含设备商dt，并定义工作流，workflows=[set_ops:[{0:self}]]，表示该算法直接使用数据源B的工作流；
5. 用户验证设备商的数据源dt，设备商A则验证算法dt，均判断满足资源使用条款后，在链上完成dt间的授权关系；
6. 医疗公司B在链上任务市场新建一个任务，并将算法dt提交到该任务的工作下；
7. 医疗公司B向设备商A发起远程操作请求。设备商A核实算法，通过的话，首先告知所有用户，随后运行FedAverage；
8. 用户接收设备商A的消息，具有数据利用的知情权(可根据链上的任务工作市场和dt授权关系信息进行追溯)，随后运行EdgeComp。

在以上的过程中，设备商A和医疗公司B都不接触到原始的用户数据，只拿到中间数据或结果数据。各方都知道自己的资源被如何使用，用户也在确认授权后才执行本地计算。